@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@model IEnumerable<EIS.EISModels.ViewShiftViewResult>
@using EIS.Helpers
@using Microsoft.AspNetCore.Localization
@using System.Globalization;


@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/EISDesign/_Layout.cshtml";
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedid = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedid"];
    //IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidgreen = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidgreen"];
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidgreenline = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidgreenline"];
    //IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidyellow = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidyellow"];
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidyellowline = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidyellowline"];
    //IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidred = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidred"];
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidredline = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidredline"];
    //IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidtext = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidtext"];
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidtextline = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidtextline"];
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidgray = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidgray"];
    //IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidpoint = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidpoint"];
    IEnumerable<EIS.EISModels.ViewShiftViewResult> sortedidpointline = (IEnumerable<EIS.EISModels.ViewShiftViewResult>)ViewData["sortedidpointline"];
    EIS.EISModels.ViewShiftViewResult lastvalue = (EIS.EISModels.ViewShiftViewResult)ViewData["lastvalue"];
    int shift = (int)ViewData["shift"];
    int stationid = (int)ViewData["stationid"];
    int stationidline = (int)ViewData["stationidline"];
}
<div id="PlaceHolderHere"></div>
@if (!SignInManager.IsSignedIn(User))
{
    <head>
        <meta http-equiv="refresh" content="0; url='/Identity/Account/Login'" />
    </head>
}
else
{
    <div class="kanbanview">
        <div class="row" style="margin: 0px 5px">
            <!-- ShiftView -->
            <div class="col-xl-12" style="padding: 5px">
                <div class="card" style="min-height: 82vh;">
                    <div class="card-body chartview" style="padding: 10px 15px">
                        <h3 class="card-title" style="padding: 8px 0 0 3px">
                            @Html.DisplayName(@EIS.Resources.Resource.ResourceManager.GetString("ShiftView", System.Globalization.CultureInfo.CurrentCulture))
                        </h3>
                        <table id="shiftview" class="table table-bordered table-head-fixed text-nowrap table-sm" style="width: 100%; margin-top: 5px !important">
                            <thead>
                                <tr class="tableheader">
                                    <th width="2%" style="text-align: center">
                                        <i class="fa-regular fa-clock" style="font-size: 18px; vertical-align: middle"></i>
                                    </th>
                                    <th width="23%" style="padding-left: 0px;padding-right: 0px;border: none;">
                                        <table width="100%">
                                            <tr>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: left; vertical-align: middle; font-size: medium; height: 24px;">
                                                        &nbsp;
                                                    </div>
                                                </td>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: right; vertical-align: middle; font-size: medium; height: 24px;">
                                                        :1
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </th>
                                    <th width="23%" style="padding-left: 0px;padding-right: 0px;border: none;">
                                        <table width="100%">
                                            <tr>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: left; vertical-align: middle; font-size: medium; height: 24px;">
                                                        5
                                                    </div>
                                                </td>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: right; vertical-align: middle; font-size: medium; height: 24px;">
                                                        :3
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </th>
                                    <th width="23%" style="padding-left: 0px;padding-right: 0px;border: none;">
                                        <table width="100%">
                                            <tr>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: left; vertical-align: middle; font-size: medium; height: 24px;">
                                                        0
                                                    </div>
                                                </td>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: right; vertical-align: middle; font-size: medium; height: 24px;">
                                                        :4
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </th>
                                    <th width="23%" style="padding-left: 0px;padding-right: 0px;">
                                        <table width="100%">
                                            <tr>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: left; vertical-align: middle; font-size: medium; height: 24px;">
                                                        5
                                                    </div>
                                                </td>
                                                <td width="50%" style="padding-left: 0px;padding-right: 0px;padding-top: 0px;padding-bottom: 0px;border: none;">
                                                    <div style="text-align: right; vertical-align: middle; font-size: medium; height: 24px;">
                                                        &nbsp;
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </th>
                                    <th width="3%" style="text-align: center;max-width:45px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                        @Html.DisplayName(@EIS.Resources.Resource.ResourceManager.GetString("Output", System.Globalization.CultureInfo.CurrentCulture))
                                    </th>
                                    <th width="3%" style="text-align: center;max-width:40px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">
                                        @Html.DisplayName(@EIS.Resources.Resource.ResourceManager.GetString("OEE%", System.Globalization.CultureInfo.CurrentCulture))
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr class="tablebody">
                                        <td width="2%" style="height: 4.6rem;text-align: center; vertical-align: middle; padding: 0rem">
                                            @if (item.Hour.Value < 10)
                                                { @Html.Raw("0")@Html.DisplayFor(modelItem => item.Hour) }
                                            else
                                                { @Html.DisplayFor(modelItem => item.Hour) }
                                        </td>
                                        <td colspan="4" style="height: 4.6rem; padding: 0">
										    <svg viewBox="0 0 3600 164" height="4.6rem" width="100%" preserveAspectRatio="none">
                                                @if (sortedid.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedid)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @* @if (@stationid == @stationidline)
                                                            { *@
                                                                @Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 82 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-shiftviewline"+@item1.Muszak.Value+") stroke-width=\"144\" />")
                                                            @* }
                                                            else
                                                            {
                                                                @if (lastvalue.Hour.Value == item1.Hour.Value)
                                                                {
                                                                    @Html.Raw("<path d=\"M 0, 46 H "+@lastvalue.CT.Value.ToString()+"\" stroke=var(--eck-shiftview"+@lastvalue.Muszak.Value+") stroke-width=\"72\" />")
                                                                    @Html.Raw("<path d=\"M "+@lastvalue.Time.Value.ToString()+", 46 H 3600\" stroke=var(--eck-shiftviewline"+@lastvalue.Muszak.Value+") stroke-width=\"72\" />")
                                                                }
                                                                else
                                                                {
                                                                    @if (lastvalue.TimeStamp.Value < item1.TimeStamp.Value)
                                                                    {
                                                                        @Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 46 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-shiftviewline"+@item1.Muszak.Value+") stroke-width=\"72\" />")
                                                                    }
                                                                    else
                                                                    {
                                                                        @Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 46 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-shiftview"+@item1.Muszak.Value+") stroke-width=\"72\" />")
                                                                    }
                                                                }
                                                                @Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 118 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-shiftviewline"+@item1.Muszak.Value+") stroke-width=\"72\" />")
                                                            } *@
                                                        }
                                                    }
                                                }
                                                @* @if (sortedidred.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidred)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<path id=\""+@item1.Status+"\" class=\"enabled\" d=\"M "+@item1.Time.Value.ToString()+", 46 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-darkgray) stroke-width=\"72\" />")
                                                        }
                                                    }
                                                } *@
                                                @if (sortedidredline.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidredline)
													{
														@if (item1.Hour.Value == item.Hour.Value)
														{
                                                            @Html.Raw("<path id=\""+@item1.Status+"\" class=\"enabled\" d=\"M "+@item1.Time.Value.ToString()+", 82 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-darkgray) stroke-width=\"144\" />")
														}
													}
                                                }
                                                @* @if (sortedidyellow.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidyellow)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 46 H "+item1.CT.Value.ToString()+"\" stroke=var(--eck-gray) stroke-width=\"72\" />")
                                                        }
                                                    }
                                                } *@
                                                @if (sortedidyellowline.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidyellowline)
													{
														@if (item1.Hour.Value == item.Hour.Value)
														{
															@Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 82 H "+item1.CT.Value.ToString()+"\" stroke=var(--eck-gray) stroke-width=\"144\" />")
														}
													}
                                                }
                                                @* @if (sortedidgreen.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidgreen)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 46 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-green) stroke-width=\"72\" />")
                                                        }
                                                    }
                                                } *@
                                                @if (sortedidgreenline.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidgreenline)
													{
														@if (item1.Hour.Value == item.Hour.Value)
														{
															@Html.Raw("<path d=\"M "+@item1.Time.Value.ToString()+", 82 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-green) stroke-width=\"144\" />")
														}
													}
                                                }
                                                @if (sortedidtextline.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidtextline)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<text class=\"prod\" fill=\"var(--eck-boardgray)\" text-anchor=\"start\" x=\"")
                                                            @Html.DisplayFor(modelItem => item1.Time)
                                                            @Html.Raw("px\" y=\"135px\">")
                                                            @Html.DisplayFor(modelItem => item1.Type)
                                                            @Html.Raw("<title>")
                                                            @Html.DisplayFor(modelItem => item1.Status)
                                                            @Html.Raw("</title></text>")
                                                        }
                                                    }
                                                }
                                                @if (sortedidgray.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidgray)
													{
														@if (item1.Hour.Value == item.Hour.Value)
														{
                                                            @Html.Raw("<path id=\""+@item1.Status+"\" class=\"enabled\" d=\"M "+@item1.Time.Value.ToString()+", 82 H "+@item1.CT.Value.ToString()+"\" stroke=var(--eck-boardgray) stroke-width=\"42\" />")
														}
													}
                                                }                                                
                                                @if (sortedidgray.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidgray)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<text class=\"prod\" text-anchor=\"start\" x=\"")
                                                            @Html.DisplayFor(modelItem => item1.Time)
                                                            @Html.Raw("px\" y=\"92px\">")
                                                            @Html.DisplayFor(modelItem => item1.Status)
                                                            @Html.Raw("<title>")
                                                            @Html.DisplayFor(modelItem => item1.Status)
                                                            @Html.Raw("</title></text>")
                                                        }
                                                    }
                                                }
                                                @*@if (sortedidpoint.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidpoint)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<circle class=\"prod\" cx=\"")
                                                            @Html.DisplayFor(modelItem => item1.Time)
                                                            @Html.Raw("px\" cy=\"16px\" r=\"10px\" fill=\"var(--eck-boardgray)\" stroke=\"var(--eck-navgray)\" stroke-width=\"2\"><title>")
                                                            @Html.Raw(item1.TimeStamp.Value.ToString("hh:mm:ss"))
                                                            @Html.Raw(" (")
                                                            @Html.DisplayFor(modelItem => item1.Type)
                                                            @Html.Raw(")")
                                                            @Html.Raw("</title></circle>")
                                                        }
                                                    }
                                                }*@
                                                @if (sortedidpointline.Count() > 0)
                                                {
                                                    @foreach (var item1 in sortedidpointline)
                                                    {
                                                        @if (item1.Hour.Value == item.Hour.Value)
                                                        {
                                                            @Html.Raw("<circle class=\"prod\" cx=\"")
                                                            @Html.DisplayFor(modelItem => item1.Time)
                                                            @Html.Raw("px\" cy=\"148px\" r=\"10px\" fill=\"var(--eck-boardgray)\" stroke=\"var(--eck-navgray)\" stroke-width=\"2\"><title>")
                                                            @Html.Raw(item1.TimeStamp.Value.ToString("hh:mm:ss"))
                                                            @Html.Raw(" (")
                                                            @Html.DisplayFor(modelItem => item1.Type)
                                                            @Html.Raw(")")
                                                            @Html.Raw("</title></circle>")
                                                        }
                                                    }
                                                }
                                                <path d="M 300,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                                <path d="M 600,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                                <path d="M 900,0 V 164" stroke=var(--eck-gray) stroke-width="1" />
                                                <path d="M 1200,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10"/>
                                                <path d="M 1500,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                                <path d="M 1800,0 V 164" stroke=var(--eck-gray) stroke-width="1" />
                                                <path d="M 2100,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                                <path d="M 2400,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                                <path d="M 2700,0 V 164" stroke=var(--eck-gray) stroke-width="1" />
                                                <path d="M 3000,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                                <path d="M 3300,0 V 164" stroke=var(--eck-gray) stroke-width="1" stroke-dasharray="10" />
                                            </svg>
                                        </td>
                                        <td width="3%" style="height: 4.6rem;text-align: center; vertical-align: middle; line-height:95%; padding: 0rem">
                                            @Html.DisplayFor(modelItem => item.CNT)<br>&#9135;&#9135;&#9135;<br>@Html.DisplayFor(modelItem => item.Request)
                                        </td>
                                        <td width="3%" style="height: 4.6rem;text-align: center; vertical-align: middle; padding: 0rem">
                                            @Html.DisplayFor(modelItem => item.OEE)@Html.Raw("%")
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                        <div class="description"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
<style>    
    svg {
      display: block;
    }
    
    .heyo:hover {
      fill: #CC2929;
      -moz-transition: 0.3s;
      -o-transition: 0.3s;
      -webkit-transition: 0.3s;
      transition: 0.3s;
    }
    
    .enabled {
      fill: #21669E;
      cursor: pointer;
    }
    
    .description {
      white-space: nowrap;
      color: var(--eck-textgray);
      background-color: var(--eck-boardgray);
      pointer-events: none;
      position: absolute;
      font-size: 18px;
      text-align: center;
      background: white;
      padding: 10px 10px 10px 10px;
      z-index: 9999;
      min-height: 40px;
      line-height: 40px;
      margin: 0 auto;
      color: #21669e;
      border-radius: 5px;
      box-shadow: 0 0 0 1px #eee;
      -moz-transform: translateX(-50%);
      -ms-transform: translateX(-50%);
      -webkit-transform: translateX(-50%);
      transform: translateX(-50%);
      display: none;
    }
    .description.active {
      display: block;
    }
    .description:after {
      content: "";
      position: absolute;
      left: 50%;
      top: 100%;
      width: 0;
      height: 0;
      margin-left: -10px;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-top: 10px solid white;
    }
</style>
<script>
    $(function() {
        $description = $(".description");
    
        $(".enabled").hover(
            function () {
            $(this).attr("class", "enabled heyo");
            $description.addClass("active");
            $description.html($(this).attr("id"));
            },
            function () {
            $description.removeClass("active");
            }
        );

        $(document).on("mousemove", function (e) {
            var topheight = $(".content-header.m-0").outerHeight();
            var ypos = e.pageY - (topheight + $(".description").outerHeight());
            if ($(".content-header.m-0").outerWidth()>1024)
            {
                ypos = e.pageY - (topheight + $(".description").innerHeight());
            }
            $description.css({
            left: e.pageX - 68,
            top: ypos - 68
            });
        });
    });
</script>